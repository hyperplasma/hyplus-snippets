<div id="launcher-container"></div>
<canvas id="firework-canvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 99999;"></canvas>

<style>
    #launcher-container .firework-launcher {
        cursor: pointer !important;
        position: fixed !important;
        z-index: 99999 !important;
        user-select: none !important;
        width: 80px !important;
        height: 80px !important;
        font-size: 60px !important;
        line-height: 80px !important;
        text-align: center !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
        filter: drop-shadow(2px 4px 8px rgba(0,0,0,0.3)) !important;
        background: transparent !important;
    }

    #launcher-container .firework-launcher:hover { transform: scale(1.05) !important; }
    #launcher-container .firework-launcher:active {
        transform: scale(0.9) !important;
        transition: transform 0.05s !important;
    }
</style>

<script>
(function() {
    const canvas = document.getElementById('firework-canvas');
    const ctx = canvas.getContext('2d');
    const container = document.getElementById('launcher-container');
    const launcherCount = 3;
    let launchers = [];
    let isCoolingDown = false;
    const COOLDOWN_TIME = 1500;

    function getRandomVelocity() {
        const speed = Math.random() * 1.2 + 0.8;
        return (Math.random() < 0.5 ? 1 : -1) * speed;
    }

    function init() {
        for (let i = 0; i < launcherCount; i++) {
            const el = document.createElement('div');
            el.className = 'firework-launcher';
            el.innerHTML = 'üß®';
            el.dataset.index = i;
            container.appendChild(el);
            launchers.push({
                el: el,
                x: Math.random() * (window.innerWidth - 100) + 50,
                y: Math.random() * (window.innerHeight - 100) + 50,
                velX: getRandomVelocity(),
                velY: getRandomVelocity(),
                size: 80
            });
        }
    }

    function move() {
        launchers.forEach(l => {
            l.x += l.velX;
            l.y += l.velY;
            if (l.x <= 0 || l.x >= window.innerWidth - l.size) l.velX *= -1;
            if (l.y <= 0 || l.y >= window.innerHeight - l.size) l.velY *= -1;
            l.el.style.left = l.x + 'px';
            l.el.style.top = l.y + 'px';
        });
        requestAnimationFrame(move);
    }

    let particles = [];
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    class Particle {
        constructor(x, y, color, speed, angle) {
            this.x = x;
            this.y = y;
            this.color = color;
            this.velocity = { x: Math.cos(angle) * speed, y: Math.sin(angle) * speed };
            this.alpha = 1;
            this.friction = 0.96;
            this.gravity = 0.12;
        }
        draw() {
            ctx.globalAlpha = this.alpha;
            ctx.beginPath();
            ctx.arc(this.x, this.y, 2.5, 0, Math.PI * 2);
            ctx.fillStyle = this.color;
            ctx.fill();
        }
        update() {
            this.velocity.x *= this.friction;
            this.velocity.y *= this.friction;
            this.velocity.y += this.gravity;
            this.x += this.velocity.x;
            this.y += this.velocity.y;
            this.alpha -= 0.01;
        }
    }

    function explode() {
        const x = Math.random() * (window.innerWidth - 200) + 100;
        const y = Math.random() * (window.innerHeight - 200) + 100;
        const color = `hsl(${Math.random() * 360}, 100%, 65%)`;
        const particleCount = 100;
        const basePower = Math.random() * 10 + 10;
        for (let i = 0; i < particleCount; i++) {
            const angle = Math.random() * Math.PI * 2;
            const speed = Math.random() * basePower;
            particles.push(new Particle(x, y, color, speed, angle));
        }
    }

    function launchEffect() {
        // Â¶ÇÊûúÈ°µÈù¢Â§Ñ‰∫éÈöêËóèÁä∂ÊÄÅÔºåÁõ¥Êé•Ë∑≥ËøáÔºå‰∏ç‰∫ßÁîü‰ªª‰ΩïÁ≤íÂ≠ê
        if (document.hidden) return;

        let count = Math.random() < 0.005 ? 10 : Math.floor(Math.random() * 4) + 3;
        for (let i = 0; i < count; i++) {
            setTimeout(explode, i * 300);
        }
    }

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach((p, i) => {
            if (p.alpha > 0) {
                p.update();
                p.draw();
            } else {
                particles.splice(i, 1);
            }
        });
        requestAnimationFrame(animate);
    }

    init();
    move();
    animate();

    container.addEventListener('mousedown', (e) => {
        if (e.target.classList.contains('firework-launcher')) {
            if (isCoolingDown) return;
            isCoolingDown = true;
            launchEffect();
            const index = e.target.dataset.index;
            const l = launchers[index];
            if (l) {
                l.velX = getRandomVelocity() * 2; 
                l.velY = getRandomVelocity() * 2;
            }
            setTimeout(() => { isCoolingDown = false; }, COOLDOWN_TIME);
        }
    });

    // --- Ê†∏ÂøÉ‰øÆÂ§çÔºöÊõ¥Êô∫ËÉΩÁöÑËá™Âä®ËÆ°Êó∂Âô® ---
    let autoLaunchTimer;

    function startTimer() {
        // ÂÖàÊ∏ÖÁêÜÊóßÁöÑÔºåÈò≤Ê≠¢ÈáçÂ§ç
        stopTimer();
        autoLaunchTimer = setInterval(() => {
            launchEffect();
        }, 30000);
    }

    function stopTimer() {
        if (autoLaunchTimer) clearInterval(autoLaunchTimer);
    }

    // ÁõëÂê¨Ê†áÁ≠æÈ°µÂèØËßÅÊÄßÂèòÂåñ
    document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
            stopTimer(); // Á¶ªÂºÄÈ°µÈù¢ÔºåÂÅúÊ≠¢ËÆ°Êï∞
        } else {
            startTimer(); // ÂõûÊù•È°µÈù¢ÔºåÈáçÊñ∞ÂºÄÂßã 30s ËÆ°Êï∞
        }
    });

    // ÂàùÂßãÂêØÂä®
    startTimer();

})();
</script>