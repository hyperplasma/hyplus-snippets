<div id="launcher-container"></div>
<canvas id="firework-canvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 99999;"></canvas>

<style>
    #launcher-container .firework-launcher {
        cursor: pointer !important;
        position: fixed !important;
        z-index: 99999 !important;
        user-select: none !important;
        width: 80px !important;
        height: 80px !important;
        font-size: 60px !important;
        line-height: 80px !important;
        text-align: center !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
        filter: drop-shadow(2px 4px 8px rgba(0,0,0,0.3)) !important;
        background: transparent !important;
    }

    #launcher-container .firework-launcher:hover {
        transform: scale(1.05) !important;
    }

    #launcher-container .firework-launcher:active {
        transform: scale(0.95) !important;
        transition: transform 0.05s !important;
    }
</style>

<script>
(function() {
    const canvas = document.getElementById('firework-canvas');
    const ctx = canvas.getContext('2d');
    const container = document.getElementById('launcher-container');
    const launcherCount = 3;
    let launchers = [];

    function init() {
        for (let i = 0; i < launcherCount; i++) {
            const el = document.createElement('div');
            el.className = 'firework-launcher';
            el.innerHTML = 'ğŸ§¨';
            container.appendChild(el);

            launchers.push({
                el: el,
                x: Math.random() * (window.innerWidth - 100) + 50,
                y: Math.random() * (window.innerHeight - 100) + 50,
                velX: (Math.random() - 0.5) * 1.2,
                velY: (Math.random() - 0.5) * 1.2,
                size: 80
            });
        }
    }

    function move() {
        launchers.forEach(l => {
            l.x += l.velX;
            l.y += l.velY;
            if (l.x <= 0 || l.x >= window.innerWidth - l.size) l.velX *= -1;
            if (l.y <= 0 || l.y >= window.innerHeight - l.size) l.velY *= -1;
            l.el.style.left = l.x + 'px';
            l.el.style.top = l.y + 'px';
        });
        requestAnimationFrame(move);
    }

    let particles = [];
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    class Particle {
        constructor(x, y, color, speed, angle) {
            this.x = x;
            this.y = y;
            this.color = color;
            // æ ¸å¿ƒä¿®æ”¹ï¼šä½¿ç”¨æ­£å¼¦å’Œä½™å¼¦ç¡®ä¿å®Œç¾çš„åœ†å½¢æ‰©æ•£
            this.velocity = {
                x: Math.cos(angle) * speed,
                y: Math.sin(angle) * speed
            };
            this.alpha = 1;
            this.friction = 0.96; // ç¨å¾®è°ƒé«˜æ‘©æ“¦åŠ›ï¼Œè®©åœ†å½¢ä¿æŒæ›´ä¹…
            this.gravity = 0.12;
        }
        draw() {
            ctx.globalAlpha = this.alpha;
            ctx.beginPath();
            ctx.arc(this.x, this.y, 2.5, 0, Math.PI * 2);
            ctx.fillStyle = this.color;
            ctx.fill();
        }
        update() {
            this.velocity.x *= this.friction;
            this.velocity.y *= this.friction;
            this.velocity.y += this.gravity;
            this.x += this.velocity.x;
            this.y += this.velocity.y;
            this.alpha -= 0.01;
        }
    }

    function explode() {
        const x = Math.random() * (window.innerWidth - 200) + 100;
        const y = Math.random() * (window.innerHeight - 200) + 100;
        const color = `hsl(${Math.random() * 360}, 100%, 65%)`;
        const particleCount = 120;
        const basePower = Math.random() * 10 + 8;

        for (let i = 0; i < particleCount; i++) {
            // æ ¸å¿ƒä¿®æ”¹ï¼šå‡åŒ€åˆ†å¸ƒè§’åº¦ (0 åˆ° 2Ï€)
            const angle = Math.random() * Math.PI * 2;
            // ä½¿ç”¨éšæœºé€Ÿåº¦ä½¿åœ†å¿ƒå¤„ä¹Ÿæœ‰ç²’å­ï¼Œè§†è§‰æ›´é¥±æ»¡
            const speed = Math.random() * basePower;
            particles.push(new Particle(x, y, color, speed, angle));
        }
    }

    function launchEffect() {
        let count = Math.random() < 0.005 ? 10 : Math.floor(Math.random() * 4) + 3;
        for (let i = 0; i < count; i++) {
            setTimeout(explode, i * 300);
        }
    }

    function animate() {
        // ä½¿ç”¨åŠé€æ˜å¡«å……å®ç°æ·¡æ·¡çš„æ‹–å°¾æ•ˆæœï¼Œå¢åŠ åŠ¨æ„Ÿ
        ctx.fillStyle = 'rgba(255, 255, 255, 0.15)'; 
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        particles.forEach((p, i) => {
            if (p.alpha > 0) {
                p.update();
                p.draw();
            } else {
                particles.splice(i, 1);
            }
        });
        requestAnimationFrame(animate);
    }

    init();
    move();
    animate();

    container.addEventListener('mousedown', (e) => {
        if (e.target.classList.contains('firework-launcher')) {
            launchEffect();
        }
    });
})();
</script>